# AI海龟汤聊天室

一个基于Flask和OpenAI API的在线海龟汤推理游戏聊天室，支持多人实时互动和AI主持人。

## 🎯 项目简介

海龟汤是一种推理游戏，出题者给出不完整的"汤面"（题目），猜题者通过提问来推理出完整的故事。本应用将传统海龟汤游戏与AI技术结合，提供在线多人游戏体验。

### 主要功能

- 🏠 **房间系统**: 创建/加入房间，支持邀请码
- 🤖 **AI主持人**: 基于OpenAI API的智能主持人
- 👥 **多人聊天**: 实时群聊功能，支持在线用户显示
- 📝 **题目管理**: 房主可上传和管理海龟汤题目
- 🎮 **游戏流程**: 完整的海龟汤游戏流程，包括答案揭晓
- 💬 **双聊天系统**: AI对话 + 无AI群聊

## 🛠️ 技术栈

- **后端**: Flask (Python)
- **前端**: HTML5 + CSS3 + JavaScript
- **AI**: OpenAI API
- **实时通信**: 轮询机制
- **样式**: 现代化UI设计

## 📦 安装部署

### 环境要求

- Python 3.7+
- 网络连接（用于访问OpenAI API）

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd haiguitang
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **运行应用**
   ```bash
   python app.py
   ```

4. **访问应用**
   打开浏览器访问 `http://localhost:5000`

## 🎮 使用教程

### 1. 创建房间

1. 打开应用首页
2. 点击"创建房间"
3. 填写以下信息：
   - **昵称**: 你的游戏昵称
   - **代理地址**: OpenAI API代理地址（默认：http://api.0ha.top/v1）
   - **API Key**: 你的OpenAI API密钥
   - **模型名**: 使用的AI模型（默认：gpt-4o-mini）
4. 点击"创建并进入房间"
5. 系统会生成6位邀请码，分享给其他玩家

### 2. 加入房间

1. 在首页点击"加入房间"
2. 输入你的昵称
3. 输入房主提供的邀请码
4. 点击"加入房间"

### 3. 游戏流程

#### 房主操作

1. **上传题目**（可选）:
   - 准备海龟汤题目的JSON文件
   - 点击"上传题目"按钮
   - 选择JSON文件上传

2. **设置当前题目**:
   - 从已上传的题目中选择一个
   - 点击"设为当前题目"

3. **管理游戏**:
   - 监控玩家提问
   - 在适当时机揭晓答案

#### 玩家操作

1. **参与推理**:
   - 在聊天框输入问题
   - AI主持人会根据规则回答"是"、"不是"或"不重要"

2. **群聊交流**:
   - 使用无AI群聊功能与其他玩家交流
   - 支持@用户名高亮显示

3. **查看在线用户**:
   - 右侧面板显示当前在线玩家

### 4. 题目格式

海龟汤题目需要JSON格式，示例：

```json
{
  "surface": "一个人走进餐厅，点了一份海龟汤，尝了一口后自杀了。为什么？",
  "answer": "这个人以前在海上遇难，同伴为了生存而牺牲，他喝的海龟汤正是用同伴的肉做的。",
  "victory_condition": "猜出这个人自杀的原因",
  "additional": "这个人有特殊的经历背景"
}
```

或批量上传：

```json
[
  {
    "surface": "题目1",
    "answer": "答案1",
    "victory_condition": "胜利条件1"
  },
  {
    "surface": "题目2", 
    "answer": "答案2",
    "victory_condition": "胜利条件2"
  }
]
```

## 🔧 配置说明

### 环境变量

- `FLASK_ENV`: 运行环境（development/production）
- `SECRET_KEY`: Flask会话密钥

### API配置

- **代理地址**: 支持自定义OpenAI API代理
- **模型选择**: 支持各种OpenAI模型
- **API密钥**: 需要有效的OpenAI API密钥

## 📁 项目结构

```
haiguitang/
├── app.py              # Flask主应用
├── requirements.txt    # Python依赖
├── static/
│   └── main.js        # 前端JavaScript
└── templates/
    └── index.html     # 主页面模板
```

## 🚀 功能特性

### 核心功能
- ✅ 房间创建和管理
- ✅ 实时消息轮询
- ✅ AI主持人对话
- ✅ 在线用户显示
- ✅ 题目上传和管理
- ✅ 答案揭晓功能

### 用户体验
- ✅ 现代化UI设计
- ✅ 响应式布局
- ✅ 实时状态更新
- ✅ 会话持久化
- ✅ 错误处理

### 技术特性
- ✅ 线程安全的消息处理
- ✅ 心跳检测机制
- ✅ 消息历史记录
- ✅ 用户权限管理

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 🆘 常见问题

### Q: 如何获取OpenAI API密钥？
A: 访问 [OpenAI官网](https://platform.openai.com/) 注册账号并生成API密钥。

### Q: 支持哪些AI模型？
A: 支持所有OpenAI提供的模型，推荐使用 gpt-4o-mini 或 gpt-3.5-turbo。

### Q: 房间会永久保存吗？
A: 房间数据存储在内存中，服务器重启后会丢失。

### Q: 最多支持多少玩家？
A: 理论上无限制，但建议单房间不超过20人以保证性能。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件
- 参与讨论

---

**享受你的海龟汤推理游戏！** 🐢 
